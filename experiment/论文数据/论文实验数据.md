# 实验整理

## 实验配置
| 参数       | RTX4090            | A40                | V100            |
|------------|--------------------|--------------------|-----------------|
| 环境       | RTX4090            | A40                | V100            |
| 设备       | GeForce RTX4090    | Ampere A40         | V00             |
| SM 数量    | 128                | 128                | 80              |
| 显存       | 24 GB              | 48 GB              | 32 GB           |
| CPU        | Xeon(R) Platinum 8352V | Xeon (R) Platinum 8358P | Xeon Processor |
| CPU核心数  | 16                 | 15                 | 10              |
| CPU频率    | 2.10 GHz           | 2.60 GHz           | 3.0 GHz         |
| 操作系统   | Ubuntu 20.04       | Ubuntu 20.04       | Ubuntu 20.04    |
| CUDA 版本  | 11.8               | 11.8               | 11.8            |

## 预计算实验

在 RXT4090 机器上针对BLS12-381曲线上在MSM规模在$2^{17}-2^{24}$进行实验

``` shell

# 修改 msm/sppark/msm/pippenger.cuh  42 行 FREQUENCY 取值 
# 设置 FREQUENCY = 1,2,4,8,12,16
# bench 测试 其中 BENCH_NPOW 为 MSM规模 17-24
env BENCH_NPOW=17 cargo bench #(bench测试中已经包含了正确性验证，为了更快看到结果一般注释)
env BENCH_NPOW=17 cargo test --release 
# 使用我们提供的脚本

```

论文数据结果(随机标量跑两次取平均值)
| M\MSM scale | msm_17 | msm_18 | msm_19 | msm_20 | msm_21 | msm_22 | msm_23 | msm_24 |
|-------------|---------|---------|---------|---------|---------|---------|---------|---------|
| 1           | 28.799  | 30.214  | 33.854  | 40.851  | 54.778  | 81.963  | 132.485 | OOM     |
| 2           | 19.813  | 21.286  | 24.692  | 31.062  | 45.167  | 71.284  | 123.61  | 233.905 |
| 4           | 16.401  | 17.834  | 21.291  | 27.639  | 41.848  | 68.212  | 119.51  | 219.07  |
| 8           | 16.612  | 18.141  | 21.474  | 27.883  | 41.621  | 68.471  | 121.15  | 220.665 |
| 12          | 16.886  | 18.235  | 21.716  | 28.385  | 42.246  | 69.007  | 120.685 | 225.375 |
| 16          | 20.877  | 22.384  | 25.712  | 32.664  | 46.368  | 73.223  | 124.68  | 225.375 |

性能提升
| MSM scale \ M | 1       | 2     | 4   | 8   | 12  | 16  |
| ------------- | ------- | ----- | --- | --- | --- | --- |
| 17            | -27.51% | 5.37% | 27.29%    |  25.67% |  23.63%   | 0.00% |
| 18            | -25.92% | 5.16% | 25.51%    |  23.39% |  22.75%   | 0.00% |
| 19            | -24.05% | 4.13% | 20.76%    |  19.74% |  18.40%   | 0.00% |
| 20            | -20.04% | 5.16% | 18.18%    |  17.15% |  15.07%   | 0.00% |
| 21            | -15.35% | 2.66% | 10.80%    |  11.41% |  9.76%    | 0.00% |
| 22            | -10.66% | 2.72% | 7.35%     |  6.94%  |  6.11%    | 0.00% |
| 23            | -5.89%  | 0.87% | 4.33%     |  2.91%  |  3.31%    | 0.00% |
| 24            | 0%      | -3.65%| 2.88%     |  2.13%  |  0.00%    | 0.00% |

5/11 复现数据结果(目的是验证计算正确性和数据的准确性)
| M\MSM scale | msm_17 | msm_18 | msm_19 | msm_20 | msm_21 | msm_22 | msm_23 | msm_24 |
| ----------- | ------ | ------ | ------ | ------ | ------ | ------ | ------ | ------ |
| 1           | 29.177 | 30.555 | 33.885 | 40.876 | 54.866 | 82.150 | 137.04 | OOM    |
| 2           | 20.006 | 21.591 | 24.731 | 31.715 | 45.287 | 73.095 | 125.52 | 250.03 |
| 4           | 16.536 | 17.999 | 21.281 | 27.531 | 41.844 | 70.254 | 121.95 | 219.84 |
| 8           | 16.801 | 18.321 | 21.504 | 28.111 | 42.242 | 69.555 | 123.09 | 217.39 |
| 12          | 16.883 | 18.349 | 21.641 | 28.142 | 42.384 | 68.652 | 121.86 | 217.73 |
| 16          | 21.015 | 22.628 | 25.790 | 32.652 | 46.264 | 73.920 | 127.11 | 221.95 |

## baseline 对比实验

我们在RTX 4090 和A40上使用BLS12-381曲线对比基线实现wlc_msm_bal、wlc_msm_con和cuZK。

39.522	15.675	77.037	27.883
75.635	29.431	118.462	41.621
148.265	57.776	182.032	68.471
289.390	110.660	350.480	121.150
558.085	OOM	632.381	220.655
OOM	OOM	——	421.907

| 规模 | wlc_bal | wlc_con | cuZK   | jy-msm |
| ---- | ------- | ------- | ------ | ------ |
| 20   | 40.037  | 16.782  | 71.76  | 28.320 |
| 21   | 76.649  | 31.097  | 110.06 | 42.394 |
| 22   | 149.38  | 57.844  | 175.50 | 69.084 |
| 23   | 291.48  | 111.17  | 341.22 | 125.52 |
| 24   | 570.49  | OOM     | 610.37 | 224.73 |
| 25   | OOM     | OOM     | OOM    | 409.49 |
